"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tx_1 = require("../tx");
const evm_context_1 = require("./evm-context");
async function contractCreation(worldState, sender, origin, gas, gasPrice, value, initCode, callDepth, modify) {
    worldState.checkpoint();
    const senderAccount = await worldState.loadAccount(sender);
    if (!senderAccount) {
        throw new Error('Sender account not found.');
    }
    const contractAddress = senderAccount.nextContractAddress();
    const contractAccount = await worldState.createAccount(contractAddress, value, BigInt(1));
    const txSubstrate = new tx_1.TxSubstrate();
    const callContext = new evm_context_1.EvmContext(worldState, initCode, Buffer.of(), origin, sender, contractAddress, value, gas, contractAccount.storage, callDepth, modify, txSubstrate);
    await contractAccount.run(callContext);
    if (callContext.reverted) {
        await worldState.revert();
    }
    else {
        contractAccount.code = callContext.returned;
        await worldState.commit();
    }
    return {
        contractAddress,
        remainingGas: BigInt(0),
        txSubstrate,
        status: !callContext.reverted,
    };
}
exports.contractCreation = contractCreation;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJhY3QtY3JlYXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZXZtL3ZtL2NvbnRyYWN0LWNyZWF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsOEJBQW9DO0FBRXBDLCtDQUEyQztBQUVwQyxLQUFLLFVBQVUsZ0JBQWdCLENBQ3BDLFVBQXNCLEVBQ3RCLE1BQWUsRUFDZixNQUFlLEVBQ2YsR0FBVyxFQUNYLFFBQWdCLEVBQ2hCLEtBQWEsRUFDYixRQUFnQixFQUNoQixTQUFpQixFQUNqQixNQUFlO0lBRWYsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBRXhCLE1BQU0sYUFBYSxHQUFHLE1BQU0sVUFBVSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzRCxJQUFJLENBQUMsYUFBYSxFQUFFO1FBQ2xCLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztLQUM5QztJQUVELE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzVELE1BQU0sZUFBZSxHQUFHLE1BQU0sVUFBVSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTFGLE1BQU0sV0FBVyxHQUFHLElBQUksZ0JBQVcsRUFBRSxDQUFDO0lBQ3RDLE1BQU0sV0FBVyxHQUFHLElBQUksd0JBQVUsQ0FDaEMsVUFBVSxFQUNWLFFBQVEsRUFDUixNQUFNLENBQUMsRUFBRSxFQUFFLEVBQ1gsTUFBTSxFQUNOLE1BQU0sRUFDTixlQUFlLEVBQ2YsS0FBSyxFQUNMLEdBQUcsRUFDSCxlQUFlLENBQUMsT0FBTyxFQUN2QixTQUFTLEVBQ1QsTUFBTSxFQUNOLFdBQVcsQ0FDWixDQUFDO0lBQ0YsTUFBTSxlQUFlLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRXZDLElBQUksV0FBVyxDQUFDLFFBQVEsRUFBRTtRQUN4QixNQUFNLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUMzQjtTQUFNO1FBQ0wsZUFBZSxDQUFDLElBQUksR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDO1FBQzVDLE1BQU0sVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQzNCO0lBRUQsT0FBTztRQUNMLGVBQWU7UUFDZixZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN2QixXQUFXO1FBQ1gsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLFFBQVE7S0FDOUIsQ0FBQztBQUNKLENBQUM7QUFuREQsNENBbURDIn0=