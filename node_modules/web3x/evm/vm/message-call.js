"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tx_1 = require("../tx");
const evm_context_1 = require("./evm-context");
async function messageCall(worldState, sender, origin, recipient, codeFrom, value, gas, data, callDepth, modify) {
    worldState.checkpoint();
    const senderAccount = (await worldState.loadAccount(sender));
    const recipientAccount = await worldState.loadOrCreateAccount(recipient);
    const codeAccount = (await worldState.loadAccount(codeFrom));
    const txSubstrate = new tx_1.TxSubstrate();
    recipientAccount.balance += value;
    senderAccount.balance -= value;
    const callContext = new evm_context_1.EvmContext(worldState, codeAccount.code, data, origin, sender, recipient, value, gas, recipientAccount.storage, callDepth, modify, txSubstrate);
    await recipientAccount.run(callContext);
    if (callContext.reverted) {
        await worldState.revert();
    }
    else {
        await worldState.commit();
    }
    return {
        remainingGas: BigInt(0),
        txSubstrate,
        status: !callContext.reverted,
        returned: callContext.returned,
    };
}
exports.messageCall = messageCall;
async function staticMessageCall(worldState, sender, origin, recipient, codeFrom, data, callDepth) {
    const codeAccount = (await worldState.loadImmutableAccount(codeFrom));
    const recipientAccount = (await worldState.loadImmutableAccount(recipient));
    const callContext = new evm_context_1.EvmContext(worldState, codeAccount.code, data, origin, sender, recipient, BigInt(0), BigInt(0), recipientAccount.storage, callDepth, false);
    await recipientAccount.run(callContext);
    return {
        returned: callContext.returned,
    };
}
exports.staticMessageCall = staticMessageCall;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZS1jYWxsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2V2bS92bS9tZXNzYWdlLWNhbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSw4QkFBb0M7QUFFcEMsK0NBQTJDO0FBRXBDLEtBQUssVUFBVSxXQUFXLENBQy9CLFVBQXNCLEVBQ3RCLE1BQWUsRUFDZixNQUFlLEVBQ2YsU0FBa0IsRUFDbEIsUUFBaUIsRUFDakIsS0FBYSxFQUNiLEdBQVcsRUFDWCxJQUFZLEVBQ1osU0FBaUIsRUFDakIsTUFBZTtJQUVmLFVBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUV4QixNQUFNLGFBQWEsR0FBRyxDQUFDLE1BQU0sVUFBVSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBRSxDQUFDO0lBQzlELE1BQU0sZ0JBQWdCLEdBQUcsTUFBTSxVQUFVLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekUsTUFBTSxXQUFXLEdBQUcsQ0FBQyxNQUFNLFVBQVUsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUUsQ0FBQztJQUM5RCxNQUFNLFdBQVcsR0FBRyxJQUFJLGdCQUFXLEVBQUUsQ0FBQztJQUV0QyxnQkFBZ0IsQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDO0lBQ2xDLGFBQWEsQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDO0lBRS9CLE1BQU0sV0FBVyxHQUFHLElBQUksd0JBQVUsQ0FDaEMsVUFBVSxFQUNWLFdBQVcsQ0FBQyxJQUFJLEVBQ2hCLElBQUksRUFDSixNQUFNLEVBQ04sTUFBTSxFQUNOLFNBQVMsRUFDVCxLQUFLLEVBQ0wsR0FBRyxFQUNILGdCQUFnQixDQUFDLE9BQU8sRUFDeEIsU0FBUyxFQUNULE1BQU0sRUFDTixXQUFXLENBQ1osQ0FBQztJQUNGLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRXhDLElBQUksV0FBVyxDQUFDLFFBQVEsRUFBRTtRQUN4QixNQUFNLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztLQUMzQjtTQUFNO1FBQ0wsTUFBTSxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUM7S0FDM0I7SUFFRCxPQUFPO1FBQ0wsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdkIsV0FBVztRQUNYLE1BQU0sRUFBRSxDQUFDLFdBQVcsQ0FBQyxRQUFRO1FBQzdCLFFBQVEsRUFBRSxXQUFXLENBQUMsUUFBUTtLQUMvQixDQUFDO0FBQ0osQ0FBQztBQWxERCxrQ0FrREM7QUFFTSxLQUFLLFVBQVUsaUJBQWlCLENBQ3JDLFVBQXNCLEVBQ3RCLE1BQWUsRUFDZixNQUFlLEVBQ2YsU0FBa0IsRUFDbEIsUUFBaUIsRUFDakIsSUFBWSxFQUNaLFNBQWlCO0lBRWpCLE1BQU0sV0FBVyxHQUFHLENBQUMsTUFBTSxVQUFVLENBQUMsb0JBQW9CLENBQUMsUUFBUSxDQUFDLENBQUUsQ0FBQztJQUN2RSxNQUFNLGdCQUFnQixHQUFHLENBQUMsTUFBTSxVQUFVLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLENBQUUsQ0FBQztJQUU3RSxNQUFNLFdBQVcsR0FBRyxJQUFJLHdCQUFVLENBQ2hDLFVBQVUsRUFDVixXQUFXLENBQUMsSUFBSSxFQUNoQixJQUFJLEVBQ0osTUFBTSxFQUNOLE1BQU0sRUFDTixTQUFTLEVBQ1QsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUNULE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFDVCxnQkFBZ0IsQ0FBQyxPQUFPLEVBQ3hCLFNBQVMsRUFDVCxLQUFLLENBQ04sQ0FBQztJQUNGLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRXhDLE9BQU87UUFDTCxRQUFRLEVBQUUsV0FBVyxDQUFDLFFBQVE7S0FDL0IsQ0FBQztBQUNKLENBQUM7QUE5QkQsOENBOEJDIn0=